version: "3"

services:
  biotechnica:
    build: .
    ports: 
      - "2076:2076"
    volumes:
      - .:/app
      - ./Data/CapturedImages:/app/CapturedImages
      - ./Data/CalibrationImages:/app/CalibrationImages
      - ./Data/UndistortedImages:/app/UndistortedImages
      - ./Data/SplitDataset:/app/SplitDataset
      - ./Config:/app/Config
      - ./Controllers:/app/Controllers
      - ./Manager:/app/Manager
      - ./Models:/app/Models
      - ./Database:/app/Database
    devices:
      - "/dev/video2:/dev/video2"
    privileged: true
    environment:
      - PYTHONPATH=/app
    command: ["sh", "-c", "if [ \"$UVICORN_RELOAD\" = \"true\" ]; then uvicorn api_server:app --host 0.0.0.0 --port 2076 --reload; else python api_server.py; fi"]

  kiroshi:
    image: node:18
    working_dir: /app
    ports:
      - "2077:2077"
    volumes:
      - ./Frontend:/app
      - /app/node_modules
    environment:
       - NODE_ENV=development
       - CHOKIDAR_USEPOLLING=true
    command: ["sh", "-c", "npm install && npm run dev"]
    depends_on:
      - biotechnica
